<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta property="og:title" content="ClaraCS" />
    <meta property="og:description" content="ClaraCS의 메인 페이지입니다." />
    <meta property="og:image" content="" />
    <title>ClaraCS – 지능형 CS 데이터 분석·인사이트 플랫폼</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="app">
  <!-- 사이드바 -->
  <aside class="sidebar">
    <div class="brand">
      <div class="logo"></div>
      <h1>ClaraCS – 데이터 인텔리전스</h1>
    </div>
    <nav class="nav">
      <a href="#" class="active"><span class="dot"></span><span>대시보드</span><span class="badge ok">Home</span></a>
      <a href="#upload"><span class="dot"></span><span>데이터 업로드</span><span></span></a>
      <a href="#mapping"><span class="dot"></span><span>컬럼 매핑</span><span></span></a>
      <a href="#classify"><span class="dot"></span><span>자동 분류</span><span></span></a>
      <a href="#report"><span class="dot"></span><span>분석 리포트</span><span></span></a>
      <a href="#export"><span class="dot"></span><span>리포트 내보내기</span><span></span></a>
      <a href="#help"><span class="dot"></span><span>설정 · 도움말</span><span></span></a>
    </nav>
    <div class="helper">
      <div><strong>프로젝트명</strong><br/><br/>INTELLIGENT CS DATA ANALYSIS & INSIGHT PLATFORM</div>
      <br/>
      <button class="CTA-button" id="getCTABtn">
          Get Your AI Report&nbsp;&rarr;
      </button>
      <br/>
      <br/>
    </div>
  </aside>

  <!-- 메인 -->
  <main class="main">

    <!-- 대시보드 -->
    <section class="section" id="dashboard">
      <div class="head">
        <h2>대시보드</h2>
        <div class="toolbar" id="period-filters">
          <button class="btn ghost active">7일</button>
          <button class="btn ghost">1달</button>
          <button class="btn ghost">3달</button>
          <button class="btn ghost">이번 분기</button>
          <button class="btn ghost">기간 설정</button>
        </div>
      </div>
      <div class="body">
        <div class="grid cols-2">
          <div class="card kpi">
            <div class="label">처리 완료 건수</div>
            <div class="value" id="completed-count">133건</div>
          </div>

          <div class="card kpi">
            <div class="label">미처리 건수</div>
            <div class="value" id="pending-count">13건</div>
          </div>
        </div>

    <div class="grid cols-2" style="margin-top:16px;">
      
      <div class="grid-vertical">
        <div class="card" style="text-align: center;">
          <strong>주요 문의 카테고리 TOP 3</strong>
          <table class="table" style="margin-top:8px;">
            <thead>
              <tr>
                <th>순위</th>
                <th>카테고리</th>
                <th class="right">건수</th>
              </tr>
            </thead>
            <tbody id="top-categories-table">
            </tbody>
          </table>
        </div>
        <div class="card" style="margin-top:16px; text-align : center;">
          <strong>카테고리별 문의 비율</strong>
          <div class="chart-box">
            <canvas id="category-pie-chart"></canvas>
          </div>
        </div>
      </div>

      <div class="card">
        <strong>인사이트 도출</strong>
        <div id="generated-insights" style="margin-top: 8px;">
          <p class="subtle">분석 리포트가 생성되면<br>AI가 핵심 인사이트를 여기에 표시합니다.</p>
        </div>
      </div>
    </div>
  </div>
</section>


    <!-- 업로드 -->
    <section class="section" id="upload">
      <div class="head">
        <h2>데이터 업로드 (.xlsx / .csv / .xls)</h2>
        <div class="toolbar">
          <label style="display:inline-flex;align-items:center;gap:4px;">
            <input type="checkbox" id="select_all" />
            전체 선택
          </label>
          <button id="delete_file" class="btn">삭제</button>
          <button id="upload_file" class="btn save">파일 첨부</button>
          <input type="file" id="file_input" style="display: none;" multiple accept=".csv, .xlsx, .xls" />
        </div>
      </div>
      <div class="body">
        <div class="uploader">
          <br/>
          <div class="title" style="font-size: 19.8px;">여기에 파일을 끌어다 놓거나, 상단의 파일 첨부를 클릭하세요.</div>
          <div class="desc" style="margin-top:6px;">필수 컬럼 예시: 접수일, 채널, 고객ID/이메일, 본문, 담당자, 카테고리(선택)</div>
          <div class="file_list"></div>
          <div id="upload_summary" class="upload-summary"></div>
        </div>
        <p class="tip" style="margin-top:10px;">※ 권장 사항 : 각 채널당 파일 수는 3~5개, 총 용량 15MB 이내로 업로드해 주세요.</p>
        <div class="card" style="margin-top:16px;">
          <strong>미리보기(상위 5행)</strong>
          <table class="table" style="margin-top:8px;">
            <thead>
              <tr>
                <th>created_at</th><th>customer_ID</th><th>channel</th><th>product_ID</th><th>category</th><th>message</th><th>status</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>2025-08-01</td><td>cust_1023</td><td>게시판</td><td>MBP16-M3-1TB-SIL</td><td>배송 지연</td><td>	주문한 상품이 아직 도착을 안 했어요. 배송...</td><td>신규</td></tr>
              <tr><td>2025-08-02</td><td>cust_3381</td><td>네이버 톡톡</td><td>MBA13-M2-256GB-MID</td><td>환불 문의</td><td>결제 취소가 안돼요. 지난주에 요청...</td><td>완료</td></tr>
              <tr><td>2025-08-02</td><td>cust_9912</td><td>전화</td><td>MBP14-M3-512GB-SPG</td><td>파손 수령</td><td>박스가 찢어져서 제품 외부에 흠집이...</td><td>완료</td></tr>
              <tr><td>2025-08-03</td><td>cust_1277</td><td>게시판<td>MBA13-M2-256GB-MID</td></td><td>품질 불만</td><td>색상이 사진과 달라요. 화면에서 본 색과...</td><td>완료</td></tr>
              <tr><td>2025-08-03</td><td>cust_6620</td><td>카카오톡</td><td>MBA15-M3-512GB-STAR</td><td>AS 문의</td><td>작동이 중간에 멈춤. 전원 버튼을 눌러도...</td><td>진행중</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 컬럼 매핑 -->
    <section class="section" id="mapping">
      <div class="head">
        <h2>컬럼 매핑</h2>
        <div class="toolbar">
          <button id="btn-save" class="btn save">매핑 저장</button>
        </div>
      </div>
      <div class="body grid cols-2">
        <div class="card">
          <div class="column-header" style="display: flex; align-items: center; justify-content: space-between;">
            <strong>Column Setting</strong>
            
            <div class="button-mapping-group" style="display: flex; gap: 8px;">
              <button class="btn edit">Edit</button>
              <button class="btn reset">초기화</button>
              <button id="column_setting" class="btn save">컬럼 저장</button>
            </div>
          </div>
          <div class="grid" style="margin-top:23px; clear:both;">
            <div class="mapping-grid" style="display: flex; align-items: center; gap: 10px;">
              <div class="delete-btn-container"> 
                  <button class="btn delete-row-btn">&minus;</button>
              </div>
              <input class="input" value="created_at" />
              <span style="text-align:center; color:var(--muted)">→</span>
              <select class="select">
                <option>접수일</option>
              </select>
              <div class="toggle-switch">
                <input type="checkbox" class="toggle-input" id="toggle1" checked/>
                <label class="toggle-label" for="toggle1"></label>
              </div>
            </div>
            <div class="mapping-grid" style="display: flex; align-items: center; gap: 10px;">
              <div class="delete-btn-container"> 
                  <button class="btn delete-row-btn">&minus;</button>
              </div>
              <input class="input" value="customer_ID" />
              <span style="text-align:center; color:var(--muted)">→</span>
              <select class="select">
                <option>고객ID/이메일(공용)</option><option>고객ID</option><option>이메일</option>
              </select>
              <div class="toggle-switch">
                <input type="checkbox" class="toggle-input" id="toggle2" checked/>
                <label class="toggle-label" for="toggle2"></label>
              </div>
            </div>
            <div class="mapping-grid" style="display: flex; align-items: center; gap: 10px;">
              <div class="delete-btn-container"> 
                  <button class="btn delete-row-btn">&minus;</button>
              </div>
              <input class="input" value="channel" />
              <span style="text-align:center; color:var(--muted)">→</span>
              <select class="select">
                <option>채널(공용)</option><option>게시판</option><option>전화</option><option>이메일</option><option>네이버 톡톡</option><option>카카오톡</option>
              </select>
              <div class="toggle-switch">
                <input type="checkbox" class="toggle-input" id="toggle3" checked/>
                <label class="toggle-label" for="toggle3"></label>
              </div>
            </div>
            <div class="mapping-grid" style="display: flex; align-items: center; gap: 10px;">
              <div class="delete-btn-container"> 
                  <button class="btn delete-row-btn">&minus;</button>
              </div>
              <input class="input" value="product_ID" />
              <span style="text-align:center; color:var(--muted)">→</span>
              <select class="select"><option>상품ID(SKU)</option>
              </select>
              <div class="toggle-switch">
                <input type="checkbox" class="toggle-input" id="toggle4" checked/>
                <label class="toggle-label" for="toggle4"></label>
              </div>
            </div>
            <div class="mapping-grid" style="display: flex; align-items: center; gap: 10px;">
              <div class="delete-btn-container"> 
                  <button class="btn delete-row-btn">&minus;</button>
              </div>
              <input class="input" value="category" />
              <span style="text-align:center; color:var(--muted)">→</span>
              <select class="select"><option>카테고리</option>
              </select>
              <div class="toggle-switch">
                <input type="checkbox" class="toggle-input" id="toggle5" checked/>
                <label class="toggle-label" for="toggle5"></label>
              </div>
            </div>
            <div class="mapping-grid" style="display: flex; align-items: center; gap: 10px;">
              <div class="delete-btn-container"> 
                  <button class="btn delete-row-btn">&minus;</button>
              </div>
              <input class="input" value="message" />
              <span style="text-align:center; color:var(--muted)">→</span>
              <select class="select"><option>문의 내용(공용)</option><option>제목</option><option>본문</option>
              </select>
              <div class="toggle-switch">
                <input type="checkbox" class="toggle-input" id="toggle6" checked/>
                <label class="toggle-label" for="toggle6"></label>
              </div>
            </div>
            <div class="mapping-grid" style="display: flex; align-items: center; gap: 10px;">
              <div class="delete-btn-container"> 
                  <button class="btn delete-row-btn">&minus;</button>
              </div>
              <input class="input" value="status" />
              <span style="text-align:center; color:var(--muted)">→</span>
              <select class="select"><option>처리 상태</option>
              </select>
              <div class="toggle-switch">
                <input type="checkbox" class="toggle-input" id="toggle7" checked/>
                <label class="toggle-label" for="toggle7"></label>
              </div>
            </div>
          </div>
          <p class="tip" style="margin-top:3px;">※ 매핑 템플릿을 저장해두면 다음 업로드부터 자동 적용</p>
          <div class="add-btn-container">
            <button id="btn-add-row" class="btn add-row-btn">+</button>
          </div>
        </div>
        <div class="card">
          <strong>유효성/정합성 체크</strong>
          <ul class="subtle">
            <li>필수 컬럼 누락: <span class="badge danger">본문</span> 2열에서 공란 5건</li>
            <li>날짜 형식 불일치: <span class="badge warn">접수일</span> 3건(YYYY-MM-DD 권장)</li>
            <li>개인정보 마스킹: <span class="badge ok">고객ID/이메일</span> 자동 마스킹 설정</li>
          </ul>
          <div class="toolbar" style="margin-top:10px;">
            <button id="camelCase" class="btn">정제 실행</button>
          </div>
        </div>
      </div>
    </section>

    <!-- 자동 분류 -->
<section class="section" id="classify">
  <div class="head">
    <h2>자동 분류</h2>
    <div class="toolbar">
      <!-- <button class="btn">규칙 편집</button> -->
      <!-- <button class="btn">모델 교체</button> -->
      <!-- 마지막 분류 시각 표시 -->
      <span id="last-run-at" class="small muted" style="margin-left:8px;">
       마지막 분류 : -
      </span>
      <button id="btn-reset-classify" class="btn ghost" onclick="window.resetClassification && window.resetClassification()">
        초기화
      </button>
      <!-- 버튼에 id 부여: JS가 클릭 이벤트를 바인딩 -->
      <button id="btn-run-classify" class="btn primary" onclick="window.runClassification && window.runClassification()">
        분류 실행
      </button>
    </div>
  </div>

  <div class="body">
    <!-- 여기부터 그리드 컨테이너 -->
    <div class="classify-grid">
      
      <!-- 1x1 : 카테고리별 분류 결과 -->
      <div class="card card--category" id="catCard"> <!--id="catCard" 추가함(new)-->
        <strong>카테고리별 분류 결과</strong>
        <table class="table" style="margin-top:8px;">
          <thead>
            <tr><th>카테고리</th><th class="right">건수</th><th class="right">비율</th><th>예시 키워드</th></tr>
          </thead>
          <tbody id="categoryTableBody">
            <tr><td colspan="4">[분류 실행]을 눌러 데이터를 불러오세요</td></tr>
          </tbody>
        </table>
      </div>

      <!-- 1x2 + 2x2 : 채널별 분류 결과(오른쪽 열 전체를 세로로 차지) --> 
      <div class="card card--channels" id="channelsCard"> <!--id="channelsCard" 추가함(new)-->
        <div class="channels-head">
          <strong>채널별 분류 결과</strong>
          <div class="legend sticky">
            <div class="item"><span class="dot" style="background:#ff4d4f"></span>배송</div>
            <div class="item"><span class="dot" style="background:#ffa940"></span>환불/취소</div>
            <div class="item"><span class="dot" style="background:#3ddc97"></span>품질/하자</div>
            <div class="item"><span class="dot" style="background:#ffd666"></span>AS/설치</div>
            <div class="item"><span class="dot" style="background:#9aa0a6"></span>기타</div>
          </div>
        </div>
        <div id="channelCards" class="channel-grid scroll-y"><!-- JS가 카드 렌더링 --></div>
      </div>

      <!-- 2x1 : 자동 분류 정확도/신뢰도 -->
      <div class="card card--reliability" id="reliabilityCard"> <!--id="reliabilityCard" 추가함(new)-->
        <strong>자동 분류 정확도/신뢰도</strong>
        <div id="reliabilityBox" class="chart-box tall center">-</div>
        <p class="tip" style="margin-top:8px;">train/val/test, Macro-F1, Micro-F1, Accuracy</p>
      </div>

      <!-- 3x1 + 3x2 : 티켓 목록(하단 전체 폭) -->
      <div class="card card--tickets">
        <strong>티켓 목록</strong>
        <table class="table" style="margin-top:8px;">
          <thead>
            <tr>
              <th>접수일</th><th>채널</th><th>내용</th><th>카테고리</th><th>키워드</th><th class="right">신뢰도</th>
            </tr>
          </thead>
          <tbody id="ticketTableBody">
            <tr><td colspan="6">-</td></tr>
          </tbody>
        </table>
      </div>

    </div>
    <!-- 그리드 끝 -->
     
  </div>
</section>

    <!-- 분석 리포트 -->
    <section class="section" id="report">
      <div class="head">
        <h2>분석 리포트 (요약/인사이트)</h2>
        <div class="toolbar">
          <button class="btn">템플릿 선택</button>
          <button class="btn save">리포트 생성</button>
        </div>
      </div>
      <div class="body grid cols-2">
        <div class="card">
          <strong>채널별 추이</strong>
          <div class="chart-box">차트 영역 (스택 바)</div>
        </div>
        <div class="card">
          <strong>데이터 요약</strong>
          <ul class="subtle">
          </ul>
        </div>
        <div class="card">
          <strong>인사이트 도출</strong>
          <ol class="subtle">
          </ol>
        </div>
        <div class="card">
          <strong>솔루션 제안</strong>
          <ul class="subtle">
            <!-- 솔루션이 여기에 동적으로 생성됩니다 -->
          </ul>
        </div>
      </div>
    </section>

    <!-- 내보내기/공유 -->
    <section class="section" id="export">
      <div class="head">
        <h2>리포트 내보내기 · 공유</h2>
        <div class="toolbar">
          <button class="btn primary" id="btn-export-pdf">pdf</button>
        </div>
      </div>
    </section>

    <!-- 설정/도움말 -->
    <section class="section" id="help">
      <div class="head">
        <h2>설정 · 도움말</h2>
        <div class="toolbar">
          <button class="btn">마스킹 규칙</button>
          <button class="btn">분류 카테고리 관리</button>
          <button class="btn">SLA 지표</button>
          <button class="btn save">저장</button>
        </div>
      </div>
      <div class="body grid cols-3">
        <div class="card">
          <strong>보안/프라이버시</strong>
          <p class="subtle">개인정보 컬럼: 이메일/전화 → 자동 마스킹 / 암호화 보관</p>
          <label class="subtle" style="display:block; margin-top:8px;">마스킹 예시</label>
          <input class="input" value="john****@example.com, 010-12**-56**" />
        </div>
        <div class="card">
          <strong>카테고리 세트</strong>
          <p class="subtle">표준 카테고리(배송/환불/품질/AS/기타) + 사용자 정의</p>
          <input class="input" placeholder="예: 교환/반품" />
          <div class="toolbar" style="margin-top:8px;"><button class="btn">추가</button><button class="btn ghost">초기화</button></div>
        </div>
        <div class="card">
          <strong>도움말</strong>
          <ul class="subtle">
            <li>1) 업로드 → 2) 매핑 → 3) 분류 → 4) 리포트 → 5) 내보내기</li>
            <li>샘플 데이터로 먼저 리포트 흐름을 검증하세요.</li>
            <li>실제 동작은 JS/백엔드 연동 시 활성화됩니다.</li>
          </ul>
        </div>
      </div>
    </section>

  </main>
</div>
<script type="text/javascript" src="{{ url_for('static', filename='js/theme.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/sidebar.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/common.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/upload.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/report.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/mapping.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/auto_classify.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/pdf_export.js') }}"></script>
</body>
</html>